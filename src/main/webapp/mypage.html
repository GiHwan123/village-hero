<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<!-- 지도 API include -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c2c65e47ff9efd53c90ebd6f14d04ecb&libraries=services,clusterer,drawing"></script>	
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script> 
<style>
	th, td {
		border: 1px solid;
	}
</style>
</head>
<body>		
	<template id="profile">
		<div>					
			<div v-bind="logInMember">
				{{logInMember.nickname}}의 마이페이지
				<img src="{{logInMember.picture}}">
				<div class="req_count">
					심부름 요청<br>
					?번
				</div>
				<div class="done_count">
					수행 완료<br>
					?번
				</div>
			</div>
			<a href="#">회원정보 수정하기</a>
		</div>
	</template>
	
	<template id="list">
		<div>
			<div v-bind="logInMember">{{logInMember.nickname}} {{logInMember.memberId}}</div>
			<div class="menu">
				<span @click="">요청 내역</span>
				<span>수행 내역</span>
				<table id="reqList">
					<thead>
						<tr>
							<th>등록일</th><th>심부름 제목</th><th>분류</th><th>도와준 히어로</th><th>완료일</th>
						</tr>
					</thead>
					<tbody>
						<tr v-for="info in reqList">
							<td>{{info.createdAt}}</td><td>{{info.title}}</td><td>{{info.category}}</td><td>{{info.hero}}</td><td>?</td>
						</tr>
					</tbody>
				</table>
				<table id="doneList">
					<thead>
						<tr>
							<th>완료일</th><th>작성자</th><th>심부름 제목</th><th>분류</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td></td><td></td><td></td><td></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</template>
	

	<div id="app">
		<profile-com></profile-com>	
		<hr>
		<list-com></list-com>				
	</div>
	
	
	<script>
		// 이벤트버스
		let eventBus = new Vue();
	
		// 프로필 컴포넌트
		Vue.component("profile-com", {
			template: "#profile",
			data: function(){
				return {
					logInMember: ""	
				}
			},
			created : function(){
				axios({
					method: "get",
					url: "http://localhost:8088/logincheck"		
				}).then(resData => {						      			
					this.logInMember = resData.data;   						
					sessionStorage.setItem("logInMember", JSON.stringify(this.logInMember));
				}).catch(error => {
					console.log("error", error);
				});  			
				
			}, 
			methods: {				
				
			}				
		});
		
		// 나의 심부름 요청, 수행 내역 컴포넌트
		Vue.component("list-com", {
			template: "#list",
			data: function(){
				return {
					logInMember: "",  // memberId
					reqList: [],
					doneList: [],
					show: "req"
				}
			},
			created : function(){		
				
				// 이벤트버스로부터 로그인한 회원 정보 공유받아서 사용
				//eventBus.$on("logInMember", this.addLogInMember);	
				console.log("세션스토리지: " + sessionStorage.getItem("logInMember").memberId);
				axios({
					method: "get",
					url: "http://localhost:8088/my-req-done?memberId="+JSON.parse(sessionStorage.getItem("logInMember")).memberId					
				}).then(resData => {									      			
					this.reqList = resData.data;  									
				}).catch(error => {
					console.log("error", error);
				}); 
				
			},				
			methods: {
				addLogInMember: function(v){
					console.log("이벤트버스에서 받아온 데이터: " + v);
					this.logInMember = v;
				},
				changeList: function(){
					if (show == "req"){
						show = "done"
					}else{
						show = "req"
					}
				}
			}				
		});
		

		new Vue({
            el: "#app"            
        });

	</script>
	
</body>
</html>