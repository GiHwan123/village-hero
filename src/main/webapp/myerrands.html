<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script> 
<body>

<div id="app">
	<mycom></mycom>
</div>
	
	<template id="myerrand">
		<div v-bind="logInMember">
		<button @click="getmyerrands()">내가 요청한 심부름 목록</button>
		<button @click="getmyapplies()">내가 지원한 심부름 목록(진행중인)</button>
			<table v-if="myReqBool">
				<tr><th></th><th>No.</th><th>심부름 제목</th><th>상태</th></tr>
				<tr v-for="v,index in myReq" v-if="v.errandStatus!=3">
				<td>심부름 취소</td>
				<td>{{index}}</td>
				<td>{{v.title}}</td>
				<td v-if="v.errandStatus==0">지원자 대기중</td>
				<td v-if="v.errandStatus==1">매칭 대기중</td>
				<td v-if="v.errandStatus==2">취소됨</td>
				</tr>
			</table>
			<table v-if="myApplyBool">
				<tr><th></th><th>No.</th><th>심부름 제목</th><th>상태</th></tr>
				<tr v-for="v,index in myApply">
				<td>지원 취소</td>
				<td>{{index}}</td>
				<td>{{v.title}}</td>
				<td v-if="v.matchStatus==0">수락 대기중</td>
				<td v-if="v.matchStatus==2">다른사람한테 매칭됨</td>
				<td v-if="v.matchStatus==3">취소됨</td>
				</tr>
			</table>
		</div>
	</template>
	
<script>

	//현재 세션에 저장된 값 확인 component
	Vue.component("mycom",{
		template : "#myerrand",
		data : function(){
			return{
				logInMember:"",
				myReq:[],
				myReqBool : true,
				myApply : [],
				myApplyBool : false
			}
		},
		created : function(){
			axios({
					method: "get",
					url: "http://localhost:8088/logincheck"		
				}).then(resData => {						      			
					this.logInMember = resData.data;   						
					sessionStorage.setItem("logInMember", JSON.stringify(this.logInMember));
				}).catch(error => {
					console.log("error", error);
				});
			
			axios({
				method: "get",
				url: "http://localhost:8088/myerrands/req?memberId="+JSON.parse(sessionStorage.getItem("logInMember")).memberId					
			}).then(resData => {
				this.myReq = resData.data; 
			}).catch(error => {
				console.log("error", error);
			}); 
		},
		methods: {
			getmyerrands : function(){
	    		axios({
	                method : "get",
	                url : "http://localhost:8088/myerrands/req?memberId="+JSON.parse(sessionStorage.getItem("logInMember")).memberId
	            }).then( resData => {
	            	this.myReqBool=true;
	            	this.myApplyBool=false;
	                return this.myReq = resData.data;
	            }).catch(errorData => {
	            	return console.log(errorData);
	            })
	    	},
	    	getmyapplies : function(){
	    		axios({
	                method : "get",
	                url : "http://localhost:8088/myerrands/apply?memberId="+JSON.parse(sessionStorage.getItem("logInMember")).memberId
	            }).then( resData => {
	            	this.myApplyBool=true;
	            	this.myReqBool=false;
	                return this.myApply = resData.data;
	            }).catch(errorData => {
	            	return console.log(errorData);
	            })
	    	}
		}
	})

	
	new Vue({
		el:"#app"
	});
</script>
</body>
</html>