<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  
<script src="js/headerTemplate.js"></script>
<body>
	<div id="headerBar"></div>
	
	<div id="app">
		<mycom></mycom>
	</div>

	<template id="myerrand">
		<div>
			<button @click="getmyerrands()">내가 요청한 심부름 목록</button>
			<button @click="getmyapplies()">내가 지원한 심부름 목록(진행중인)</button>
			<table v-if="myReqBool">
				<tr>
					<th>No.</th>
					<th>심부름 제목</th>
					<th>상태</th>
				</tr>
				<tr v-for="v,index in myReq" v-if="v.errandStatus!=3">
					<td>{{index}}</td>
					<td><a v-bind:href="urlPart1+v.errandId">{{v.title}}</a></td>
					<td v-if="v.errandStatus==0">지원자 대기중</td>
					<td v-if="v.errandStatus==1">매칭 대기중</td>
					<td v-if="v.errandStatus==2">취소됨</td>
				</tr>
			</table>

			<table v-if="myApplyBool">
				<tr>
					<th></th>
					<th>No.</th>
					<th>심부름 작성자</th>
					<th>심부름 제목</th>
					<th>상태</th>
				</tr>
				<tr v-for="v,index in myApply">
					<td>
					<a v-if="v.matchStatus==0" v-bind:href="urlPart2+v.errandId">취소</a>
					</td>
					<td>{{index}}</td>
					<td>{{v.writer}}</td>
					<td><a v-bind:href="urlPart1+v.errandId">{{v.title}}</a></td>
					<td v-if="v.matchStatus==0">수락 대기중</td>
					<td v-if="v.matchStatus==2">다른사람한테 매칭됨</td>
					<td v-if="v.matchStatus==3">취소됨</td>
				</tr>
			</table>
			<br>
			<hr>
			<button @click="gotomain()">메인으로 이동</button>
		</div>

	</template>

	<script>

	//현재 세션에 저장된 값 확인 component
	Vue.component("mycom",{
		template : "#myerrand",
		data : function(){
			return{
				myReq:[],
				myReqBool : true,
				myApply : [],
				myApply2 : [],
				myApplyBool : false,
				urlPart1 : "http://localhost:8088/getErrandDetail/",
				urlPart2 : "http://localhost:8088/applycancel?memberId="+JSON.parse(sessionStorage.getItem("logInMember")).memberId
						+"&errandId="
			}
		},
		created : function(){
			// 상세페이지로 넘어가기
			axios({
				method: "get",
				url: "http://localhost:8088/myerrands/req?memberId="+JSON.parse(sessionStorage.getItem("logInMember")).memberId					
			}).then(resData => {
				this.myReq = resData.data; 
				
			}).catch(error => {
				console.log("error", error);
			});
			
			axios({
				method: "get",
				url: "http://localhost:8088/myerrands/apply2?memberId="+JSON.parse(sessionStorage.getItem("logInMember")).memberId					
			}).then(resData => {
				this.myApply2 = resData.data; 
				
			}).catch(error => {
				console.log("error", error);
			});
			
		},
		methods: {
			getmyerrands : function(){
	    		axios({
	                method : "get",
	                url : "http://localhost:8088/myerrands/req?memberId="+JSON.parse(sessionStorage.getItem("logInMember")).memberId
	            }).then( resData => {
	            	this.myReqBool=true;
	            	this.myApplyBool=false;
	                return this.myReq = resData.data;
	            }).catch(errorData => {
	            	return console.log(errorData);
	            })
	    	},
	    	getmyapplies : function(){
	    		axios({
	                method : "get",
	                url : "http://localhost:8088/myerrands/apply?memberId="+JSON.parse(sessionStorage.getItem("logInMember")).memberId
	            }).then( resData => {
	            	this.myApplyBool=true;
	            	this.myReqBool=false;
	                this.myApply = resData.data;
					console.log(this.myApply[0]);
	            }).catch(errorData => {
	            	return console.log(errorData);
	            })
	    	},
	    	gotomain : function(){
	    		document.location.href="/";
	    	},
	    	
		}
	})

	
	new Vue({
		el:"#app"
	});
</script>
</body>
</html>